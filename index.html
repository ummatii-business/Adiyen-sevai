<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Mini Subway Surfer</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
</head>
<body>
<script>
const W = 480, H = 720;
const ROAD_WIDTH = W * 0.6;
const LANES = [
  W/2 - ROAD_WIDTH/3,   // left lane
  W/2,                  // middle lane
  W/2 + ROAD_WIDTH/3    // right lane
];
const PLAYER_Y = H - 120;

class GameScene extends Phaser.Scene {
  constructor(){ super('Game'); }

  preload(){
    // ðŸ”¹ Load character sprite sheet
    this.load.spritesheet('player',
      'https://labs.phaser.io/assets/sprites/dude.png',
      { frameWidth: 32, frameHeight: 48 }
    );

    // ðŸ”¹ Obstacle (crate box)
    this.load.image('obstacle', 'https://labs.phaser.io/assets/sprites/crate.png');

    // ðŸ”¹ Lane marker (white line)
    this.load.image('laneMark', 'https://dummyimage.com/8x40/ffffff/000000.png');
  }

  create(){
    // --- Road background ---
    this.add.rectangle(W/2, H/2, ROAD_WIDTH+60, H, 0x0f172a)
        .setStrokeStyle(4, 0x1f2937);
    this.add.rectangle(W/2, H/2, ROAD_WIDTH, H, 0x111827);

    // --- Lane dashes ---
    this.laneDashes = this.add.group();
    for (let i=1; i<LANES.length; i++){
      const x = (LANES[i-1] + LANES[i]) / 2;
      for (let y=-30; y<H+60; y+=60){
        const dash = this.add.image(x, y, 'laneMark').setAlpha(0.4);
        this.laneDashes.add(dash);
      }
    }

    // --- Player setup ---
    this.currentLane = 1; // middle lane
    this.player = this.physics.add.sprite(LANES[this.currentLane], PLAYER_Y, 'player')
      .setDepth(10).setImmovable(true).setScale(2);

    // ðŸ”¹ Define running animation
    this.anims.create({
      key: 'run',
      frames: this.anims.generateFrameNumbers('player', { start: 0, end: 3 }),
      frameRate: 8,
      repeat: -1
    });
    this.player.play('run');

    // --- Controls ---
    this.input.keyboard.on('keydown-LEFT', ()=>{ this.movePlayer(-1); });
    this.input.keyboard.on('keydown-RIGHT', ()=>{ this.movePlayer(1); });

    // --- Obstacles group ---
    this.obstacles = this.physics.add.group();
    this.physics.add.collider(this.player, this.obstacles, ()=>this.gameOver(), null, this);

    // Timer for obstacles
    this.time.addEvent({
      delay: 1500, loop:true,
      callback: ()=>this.spawnObstacle()
    });

    // Speed values
    this.scrollSpeed = 4;
  }

  movePlayer(dir){
    let newLane = this.currentLane + dir;
    if(newLane>=0 && newLane<=2){
      this.currentLane = newLane;
      this.tweens.add({
        targets: this.player,
        x: LANES[this.currentLane],
        duration: 200,
        ease: 'Power2'
      });
    }
  }

  spawnObstacle(){
    let lane = Phaser.Math.Between(0,2);
    let obs = this.obstacles.create(LANES[lane], -50, 'obstacle');
    obs.setVelocityY(this.scrollSpeed*60);
    obs.setScale(0.6);
  }

  update(){
    // Move lane dashes
    this.laneDashes.getChildren().forEach(d=>{
      d.y += this.scrollSpeed;
      if(d.y > H+40) d.y = -40;
    });
  }

  gameOver(){
    this.scene.restart(); // simple reset
  }
}

const config = {
  type: Phaser.AUTO,
  width: W,
  height: H,
  backgroundColor: '#111827',
  physics: { default:'arcade' },
  scene: [GameScene]
};
new Phaser.Game(config);
</script>
</body>
</html>
