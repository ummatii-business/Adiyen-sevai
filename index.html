<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>World Class Car Race</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
  <style>
    body { margin: 0; background: #111; }
    canvas { display: block; margin: auto; }
  </style>
</head>
<body>
<script>
const W = 480, H = 720;

class CarRace extends Phaser.Scene {
  constructor(){ super("CarRace"); }

  create(){
    // Road background (scrolling)
    this.road = this.add.tileSprite(W/2, H/2, 300, H, 0x222).setOrigin(0.5);
    this.road.setFillStyle = 0x222;

    // Player Car
    this.player = this.add.rectangle(W/2, H-100, 50, 90, 0x00ffcc);
    this.physics.add.existing(this.player);
    this.player.body.setCollideWorldBounds(true);

    // Enemy cars
    this.enemies = this.physics.add.group();

    // Controls
    this.cursors = this.input.keyboard.createCursorKeys();

    // Score
    this.score = 0;
    this.scoreText = this.add.text(20,20,"Score: 0",{
      fontSize: "24px", color:"#fff", fontFamily:"monospace"
    });

    // Collisions
    this.physics.add.overlap(this.player, this.enemies, this.hitEnemy, null, this);

    // Enemy spawn
    this.time.addEvent({ delay: 1000, callback: this.spawnEnemy, callbackScope: this, loop: true });
  }

  spawnEnemy(){
    let x = Phaser.Math.Between(W/2-140, W/2+140);
    let enemy = this.add.rectangle(x, -100, 50, 90, 0xff4444);
    this.physics.add.existing(enemy);
    enemy.body.setVelocityY(250);
    this.enemies.add(enemy);
  }

  hitEnemy(player, enemy){
    this.physics.pause();
    player.setFillStyle(0xff0000);

    let box = this.add.rectangle(W/2,H/2,350,200,0x000000,0.85)
      .setStrokeStyle(5,0x00ffcc);
    this.add.text(W/2,H/2-40,"GAME OVER",{fontSize:"40px",color:"#ff5555",fontFamily:"monospace"}).setOrigin(0.5);
    this.add.text(W/2,H/2+30,"Score: "+this.score+"\nPress SPACE to Restart",{fontSize:"20px",color:"#fff",align:"center"}).setOrigin(0.5);

    this.input.keyboard.once("keydown-SPACE",()=>this.scene.restart());
  }

  update(){
    // Scroll road
    this.road.tilePositionY -= 5;

    // Player movement
    if(this.cursors.left.isDown) this.player.x -= 5;
    if(this.cursors.right.isDown) this.player.x += 5;
    if(this.cursors.up.isDown) this.player.y -= 5;
    if(this.cursors.down.isDown) this.player.y += 5;

    // Clamp inside road
    this.player.x = Phaser.Math.Clamp(this.player.x, W/2-140, W/2+140);
    this.player.y = Phaser.Math.Clamp(this.player.y, H-200, H-50);

    // Update score
    this.score += 1;
    this.scoreText.setText("Score: " + this.score);

    // Clean enemies offscreen
    this.enemies.children.iterate(e=>{
      if(e && e.y > H+100) e.destroy();
    });
  }
}

new Phaser.Game({
  type: Phaser.AUTO,
  width: W,
  height: H,
  backgroundColor: "#111",
  physics: { default: "arcade" },
  scene: [CarRace]
});
</script>
</body>
</html>

