<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Worldclass Runner</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
  <style>
    body { margin: 0; background: #0f172a; }
    canvas { display: block; margin: auto; }
  </style>
</head>
<body>
<script>
const W = 480;
const H = 720;
const ROAD_WIDTH = 300;

class RunnerGame extends Phaser.Scene {
  constructor() { super("RunnerGame"); }

  preload(){}

  create(){
    // Background gradient
    let bg = this.add.graphics();
    let g = bg.createLinearGradient(0, 0, 0, H);
    g.addColorStop(0, '#1e293b');
    g.addColorStop(1, '#0f172a');
    bg.fillStyle(0xffffff);
    bg.fillGradientStyle(0x1e293b,0x1e293b,0x0f172a,0x0f172a);
    bg.fillRect(0, 0, W, H);

    // Road
    this.road = this.add.rectangle(W/2, H/2, ROAD_WIDTH, H, 0x222831).setOrigin(0.5);

    // Player
    this.player = this.add.rectangle(W/2, H-80, 60, 60, 0x4fd1c5);
    this.physics.add.existing(this.player);
    this.player.body.setCollideWorldBounds(true);

    // Controls
    this.cursors = this.input.keyboard.createCursorKeys();
    this.input.on('pointerdown', p => {
      if(p.x < W/2) this.moveLeft(); else this.moveRight();
    });

    // Groups
    this.obstacles = this.physics.add.group();
    this.coins = this.physics.add.group();

    this.score = 0;
    this.scoreText = this.add.text(20, 20, "Score: 0", {
      fontSize: 24,
      color: "#fff",
      fontFamily: "monospace"
    });

    // Collisions
    this.physics.add.overlap(this.player, this.coins, this.collectCoin, null, this);
    this.physics.add.overlap(this.player, this.obstacles, this.hitObstacle, null, this);

    // Timers
    this.time.addEvent({ delay: 1500, callback: this.spawnObstacle, callbackScope: this, loop: true });
    this.time.addEvent({ delay: 1000, callback: this.spawnCoin, callbackScope: this, loop: true });
  }

  moveLeft(){ this.player.x = Phaser.Math.Clamp(this.player.x-100, W/2-ROAD_WIDTH/2+40, W/2+ROAD_WIDTH/2-40); }
  moveRight(){ this.player.x = Phaser.Math.Clamp(this.player.x+100, W/2-ROAD_WIDTH/2+40, W/2+ROAD_WIDTH/2-40); }

  spawnObstacle(){
    let x = Phaser.Math.Between(W/2-ROAD_WIDTH/2+40, W/2+ROAD_WIDTH/2-40);
    let obs = this.add.rectangle(x, -50, 70, 70, 0xff5a5f);
    this.physics.add.existing(obs);
    obs.body.setVelocityY(250);
    this.obstacles.add(obs);
  }

  spawnCoin(){
    let x = Phaser.Math.Between(W/2-ROAD_WIDTH/2+40, W/2+ROAD_WIDTH/2-40);
    let coin = this.add.circle(x, -30, 15, 0xfacc15);
    this.physics.add.existing(coin);
    coin.body.setVelocityY(200);
    this.coins.add(coin);

    // Rotate sparkle
    this.tweens.add({
      targets: coin,
      scale: { from: 1, to: 1.3 },
      duration: 500,
      yoyo: true,
      repeat: -1
    });
  }

  collectCoin(player, coin){
    this.score += 10;
    this.scoreText.setText("Score: "+this.score);
    coin.destroy();

    let particles = this.add.particles(coin.x, coin.y, 'coin', {
      speed: { min: -100, max: 100 },
      lifespan: 400,
      quantity: 8,
      scale: { start: 0.5, end: 0 }
    });
    this.time.delayedCall(500, ()=>particles.destroy());
  }

  hitObstacle(player, obs){
    this.physics.pause();
    player.setFillStyle(0xff0000);

    let panel = this.add.rectangle(W/2, H/2, 300, 200, 0x111827, 0.95)
      .setStrokeStyle(6,0x4fd1c5).setOrigin(0.5).setDepth(20);
    this.add.text(W/2, H/2-40, "Game Over", {fontSize:36, color:"#f87171", fontFamily:"monospace"})
      .setOrigin(0.5).setDepth(21);
    this.add.text(W/2, H/2+20, "Score: "+this.score+"\nTap or Space to Restart",
      {fontSize:20, color:"#e2e8f0", fontFamily:"monospace", align:"center"})
      .setOrigin(0.5).setDepth(21);

    this.input.once("pointerdown", ()=>this.scene.restart());
    this.input.keyboard.once("keydown-SPACE", ()=>this.scene.restart());
  }
}

new Phaser.Game({
  type: Phaser.AUTO,
  width: W,
  height: H,
  backgroundColor: "#0f172a",
  physics: { default: "arcade" },
  scene: [RunnerGame]
});
</script>
</body>
</html>
